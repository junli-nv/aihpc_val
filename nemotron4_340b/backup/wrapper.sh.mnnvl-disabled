#!/bin/bash
#
#ulimit -s 8192 
export CUDA_DEVICE_ORDER=PCI_BUS_ID
export LD_LIBRARY_PATH=/home/cmsupport/workspace/nccl/bins:$LD_LIBRARY_PATH
#cmd="numactl --cpunodebind=$[SLURM_LOCALID/4] --membind=$[SLURM_LOCALID/4] $@"
cmd="numactl --cpunodebind=$[SLURM_LOCALID/2] --membind=$[SLURM_LOCALID/2] $@"
#echo "HOST=$(hostname), RANK=${SLURM_PROCID}, LOCAL_RANK=${SLURM_LOCALID}, NCCL_SOCKET_IFNAME=${NCCL_SOCKET_IFNAME}, CMD=${cmd}"
eval ${cmd}
