FROM rockylinux:9.3
MAINTAINER JunLi Zhang<junliz@nvidia.com>

RUN \
  echo -e '[lenovo-hpc]\nname=Lenovo packages for HPC\nbaseurl=https://hpc.lenovo.com/yum/latest/el9/x86_64/\nenabled=1\ngpgcheck=0' > /etc/yum.repos.d/lenovo-hpc.repo && \
  yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm && \
  yum update -y && \
  yum install -y lenovo-confluent tftp-server openssh-clients openssl vim-enhanced iproute jq

RUN \
  echo -e '#!/bin/bash\nrm -f /var/run/confluent/pid /run/confluent/pid >& /dev/null\n/opt/confluent/bin/confluent -f' > /bin/runconfluent.sh

RUN \
  yum install -y procps ncurses iputils net-tools \
      pdsh pdsh-rcmd-ssh pdsh-mod-genders pdsh-mod-dshgroup pdsh-mod-netgroup \
      ipmitool

CMD ["/usr/sbin/init"]